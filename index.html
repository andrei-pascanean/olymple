<!DOCTYPE html>
<html>

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>
</head>

<body>
    <div class="container" id="mainContainer">
        <div class="modal fade" id="endGameModal" tabindex="-1" aria-labelledby="endGameModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row justify-content-center">
                            <div class="col text-center">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="toast-container position-fixed top-0 start-50 translate-middle-x p-3">
            <div id="liveErrorToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-body bg-danger-subtle text-danger-emphasis">
                    Please select a valid country from the list!
                </div>
            </div>
        </div>
        <div class="toast-container position-fixed top-0 start-50 translate-middle-x p-3">
            <div id="liveCorrectAnswerToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
                data-bs-autohide="false">
                <div class="toast-body d-flex bg-primary-subtle text-primary-emphasis justify-content-between">
                    <span id="liveCorrectAnswerToastMessage"></span>
                    <button type="button" class="btn-close me-2 m-auto " data-bs-dismiss="toast"
                        aria-label="Close"></button>
                </div>
            </div>
        </div>
        <div class="row justify-content-center mt-3 mb-3">
            <div class="col-12 col-md-8 col-lg-6 mx-auto text-center">
                <h1>
                    Olymple
                </h1>
            </div>
        </div>
        <div class="row justify-content-center mt-3 mb-3">
            <div class="col-12 col-md-8 col-lg-8 mx-auto text-center">
                <h3>
                    Guess the country based on its medals!
                </h3>
            </div>
        </div>
        <div class="row justify-content-center mt-3 mb-3">
            <div class="col-12 col-md-8 col-lg-6 mx-auto text-center">
                <h5>
                    Total: üèÖ 953
                </h5>
            </div>
        </div>
        <div class="row justify-content-center mt-3 mb-3">
            <div class="col-12 col-md-8 col-lg-6 mx-auto">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th class="text-center" scope="col">‚òÄÔ∏è Top 5 Summer Sports</th>
                            <th class="text-center" scope="col">ü•á Gold</th>
                            <th class="text-center" scope="col">ü•à Silver</th>
                            <th class="text-center" scope="col">ü•â Bronze</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="text-center">ü§∫ Fencing</td>
                            <td class="text-center">16</td>
                            <td class="text-center">47</td>
                            <td class="text-center">38</td>
                        </tr>
                        <tr>
                            <td class="text-center">üö¥ Cycling</td>
                            <td class="text-center">44</td>
                            <td class="text-center">29</td>
                            <td class="text-center">29</td>
                        </tr>
                        <tr>
                            <td class="text-center">ü•ã Judo</td>
                            <td class="text-center">18</td>
                            <td class="text-center">15</td>
                            <td class="text-center">34</td>
                        </tr>
                        <tr>
                            <td class="text-center">üêé Equestrian</td>
                            <td class="text-center">15</td>
                            <td class="text-center">16</td>
                            <td class="text-center">14</td>
                        </tr>
                        <tr>
                            <td class="text-center">‚õµ Sailing</td>
                            <td class="text-center">15</td>
                            <td class="text-center">15</td>
                            <td class="text-center">21</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-12 col-md-8 col-lg-6 mx-auto">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th class="text-center" scope="col">‚ùÑÔ∏è Top 5 Winter Sport</th>
                            <th class="text-center" scope="col">ü•á Gold</th>
                            <th class="text-center" scope="col">ü•à Silver</th>
                            <th class="text-center" scope="col">ü•â Bronze</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="text-center">‚õ∞Ô∏è‚õ∑Ô∏è Alpine skiing</td>
                            <td class="text-center">16</td>
                            <td class="text-center">17</td>
                            <td class="text-center">18</td>
                        </tr>
                        <tr>
                            <td class="text-center">üî´‚õ∑Ô∏è Biathlon</td>
                            <td class="text-center">13</td>
                            <td class="text-center">8</td>
                            <td class="text-center">12</td>
                        </tr>
                        <tr>
                            <td class="text-center">üèÇ Snowboarding</td>
                            <td class="text-center">4</td>
                            <td class="text-center">5</td>
                            <td class="text-center">4</td>
                        </tr>
                        <tr>
                            <td class="text-center">‚ú®‚õ∏Ô∏è Figure skating</td>
                            <td class="text-center">4</td>
                            <td class="text-center">3</td>
                            <td class="text-center">7</td>
                        </tr>
                        <tr>
                            <td class="text-center">‚ú®‚õ∑Ô∏è Freestyle skiing</td>
                            <td class="text-center">3</td>
                            <td class="text-center">6</td>
                            <td class="text-center">6</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="row justify-content-center mb-3 mt-3">
            <div class="col-12 col-md-8 col-lg-6 mx-auto">
                <div class="input-group">
                    <input class="form-control" list="datalistCountries" id="searchCountries"
                        placeholder="Type to search a country...">
                    <datalist id="datalistCountries"></datalist>
                    <button class="btn btn-outline-secondary" type="button" id="guess-button">üåç Guess</button>
                </div>
            </div>
        </div>
        <div class="row justify-content-center mb-2">
            <div class="col-12 col-md-8 col-lg-6 mx-auto">
                <div class="row g-1" id="guess_1">
                    <div class="col-12"><input class="form-control text-center" type="text" value="" aria-label=""
                            disabled readonly>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-center mb-2">
            <div class="col-12 col-md-8 col-lg-6 mx-auto">
                <div class="row g-1" id="guess_2">
                    <div class="col-12"><input class="form-control text-center" type="text" value="" aria-label=""
                            disabled readonly>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-center mb-2">
            <div class="col-12 col-md-8 col-lg-6 mx-auto">
                <div class="row g-1" id="guess_3">
                    <div class="col-12"><input class="form-control text-center" type="text" value="" aria-label=""
                            disabled readonly>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-center mb-2">
            <div class="col-12 col-md-8 col-lg-6 mx-auto">
                <div class="row g-1" id="guess_4">
                    <div class="col-12"><input class="form-control text-center" type="text" value="" aria-label=""
                            disabled readonly>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-center mb-2">
            <div class="col-12 col-md-8 col-lg-6 mx-auto">
                <div class="row g-1" id="guess_5">
                    <div class="col-12"><input class="form-control text-center" type="text" value="" aria-label=""
                            disabled readonly>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-center mb-5">
            <div class="col-12 col-md-8 col-lg-6 mx-auto">
                <div class="row g-1" id="share_button_placeholder">
                </div>
            </div>
        </div>

        <script>
            const gameId = 1

            const country_data = {
                "üá´üá∑ France": { lat: 46.227638, lon: 2.213749 },
                "üá©üá™ Germany": { lat: 51.165691, lon: 10.451526 },
                "üá≥üá± Netherlands": { lat: 52.132633, lon: 5.291266 },
                "üá®üá≥ China": { lat: 35.86166, lon: 104.195397 },
                "üá∫üá∏ United States": { lat: 37.09024, lon: -95.712891 },
                "üá≤üáΩ Mexico": { lat: 23.634501, lon: -102.552784 },
                "üá®üá¶ Canada": { lat: 56.130366, lon: -106.346771 },
                "üá¶üá∑ Argentina": { lat: -38.416097, lon: -63.616672 },
                "üáßüá∑ Brazil": { lat: -14.235004, lon: -14.235004 },
                "üáøüá¶ South Africa": { lat: -30.559482, lon: 22.937506 },
                "üáØüáµ Japan": { lat: 36.204824, lon: 138.252924 }
            };

            const countries = Object.keys(country_data)

            const input = document.getElementById("searchCountries");
            const datalist = document.getElementById("datalistCountries");
            const endGameModal = new bootstrap.Modal(document.getElementById("endGameModal"));

            const correct_country = "üá´üá∑ France";

            let guesses = 0;
            let performances = [];

            function haversine(lat1, lon1, lat2, lon2) {
                const R = 6371;
                const toRad = deg => deg * Math.PI / 180;
                const dLat = toRad(lat2 - lat1);
                const dLon = toRad(lon2 - lon1);
                const a = Math.sin(dLat / 2) ** 2 +
                    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                    Math.sin(dLon / 2) ** 2;
                return 2 * R * Math.asin(Math.sqrt(a));
            };

            function getDirection(lat1, lon1, lat2, lon2) {
                const toRad = deg => deg * Math.PI / 180;
                const toDeg = rad => rad * 180 / Math.PI;
                const dLon = toRad(lon2 - lon1);
                const y = Math.sin(dLon) * Math.cos(toRad(lat2));
                const x = Math.cos(toRad(lat1)) * Math.sin(toRad(lat2)) -
                    Math.sin(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.cos(dLon);
                let brng = toDeg(Math.atan2(y, x));
                brng = (brng + 360) % 360;
                const dirs = ["‚¨ÜÔ∏è", "‚ÜóÔ∏è", "‚û°Ô∏è", "‚ÜòÔ∏è", "‚¨áÔ∏è", "‚ÜôÔ∏è", "‚¨ÖÔ∏è", "‚ÜñÔ∏è"];
                return dirs[Math.round(brng / 45) % 8];
            };

            function getProximity(distance) {
                const maxDist = 20000;
                let pct = 100 - Math.round((distance / maxDist) * 100);
                return Math.max(0, Math.min(100, pct));
            };

            function getPerformance(proximity) {
                const green = 'üü©';
                const orange = 'üüß';
                const grey = '‚¨ú';

                const n_green = Math.floor(proximity / 20)

                let n_orange = 0
                let n_grey = 0

                if (n_green < 5) {
                    if (((proximity / 20) - (Math.floor(proximity / 20))) > 0.5) {
                        n_orange = 1
                    }
                    if ((n_green + n_orange) < 5) {
                        n_grey = 5 - (n_green + n_orange)
                    }
                }

                return (green.repeat(n_green) + orange.repeat(n_orange) + grey.repeat(n_grey))
            };

            function shareButtonCopyClipboard(button) {
                const clipBoardText = [
                    `#Olymple #${gameId} ${guesses}/5`,
                    performances.join("\n"),
                    "https://olymple.vercel.app"
                ].join("\n");
                navigator.clipboard.writeText(clipBoardText)
                    .then(() => {
                        button.classList.remove('btn-primary');
                        button.classList.add('btn-success');
                        button.textContent = "Copied to clipboard!";
                    });
            }

            countries.slice(0, 5).forEach(country => {
                const option = document.createElement("option");
                option.value = country;
                datalist.appendChild(option);
            });

            input.addEventListener("input", function () {
                const value = this.value.toLowerCase();
                const matches = countries.filter(country => country.toLocaleLowerCase().includes(value)).slice(0, 5);

                datalist.innerHTML = "";

                matches.forEach(match => {
                    const option = document.createElement("option");
                    option.value = match;
                    datalist.appendChild(option);
                });
            });

            document.getElementById("guess-button").onclick = () => {

                if (!country_data[input.value]) {
                    const errorToast = bootstrap.Toast.getOrCreateInstance(document.getElementById("liveErrorToast"));
                    errorToast.show();
                    return;
                }

                guesses = guesses + 1;

                const distance = Math.round(haversine(country_data[input.value].lat, country_data[input.value].lon, country_data[correct_country].lat, country_data[correct_country].lon));

                let heading = getDirection(country_data[input.value].lat, country_data[input.value].lon, country_data[correct_country].lat, country_data[correct_country].lon);

                const prox = getProximity(distance)

                const perf = getPerformance(prox)
                performances.push(perf)

                if (distance == 0) {
                    heading = 'üéâ'
                }

                const guessResultDiv = document.getElementById(`guess_${guesses}`);
                guessResultDiv.innerHTML = "";

                const result_country = document.createElement("div");
                result_country.classList.add("col-5");

                const countryInput = document.createElement("input");
                countryInput.classList.add("form-control", "text-center");
                countryInput.type = "text";
                countryInput.setAttribute("aria-label", "");
                countryInput.setAttribute("value", input.value);
                countryInput.disabled = true;
                countryInput.readOnly = true;

                result_country.appendChild(countryInput);
                guessResultDiv.appendChild(result_country);

                const result_distance = document.createElement("div");
                result_distance.classList.add("col-3");

                const distanceInput = document.createElement("input");
                distanceInput.classList.add("form-control", "text-center");
                distanceInput.type = "text";
                distanceInput.setAttribute("aria-label", "");
                distanceInput.setAttribute("value", distance + "km");
                distanceInput.disabled = true;
                distanceInput.readOnly = true;

                result_distance.appendChild(distanceInput);
                guessResultDiv.appendChild(result_distance);

                const result_heading = document.createElement("div");
                result_heading.classList.add("col-2");

                const headingInput = document.createElement("input");
                headingInput.classList.add("form-control", "text-center");
                headingInput.type = "text";
                headingInput.setAttribute("aria-label", "");
                headingInput.setAttribute("value", heading);
                headingInput.disabled = true;
                headingInput.readOnly = true;

                result_heading.appendChild(headingInput);
                guessResultDiv.appendChild(result_heading);

                document.getElementById("searchCountries").value = "";

                const result_prox = document.createElement("div");
                result_prox.classList.add("col-2");

                const proxInput = document.createElement("input");
                proxInput.classList.add("form-control", "text-center");
                proxInput.type = "text";
                proxInput.setAttribute("aria-label", "");
                proxInput.setAttribute("value", prox + "%");
                proxInput.disabled = true;
                proxInput.readOnly = true;

                result_prox.appendChild(proxInput);
                guessResultDiv.appendChild(result_prox);

                if ((guesses == 5) || (distance == 0)) {
                    document.getElementById("guess-button").disabled = true;

                    const correctAnswerToastEl = document.getElementById("liveCorrectAnswerToast");
                    const correctAnswerToastMessage = document.getElementById("liveCorrectAnswerToastMessage");
                    correctAnswerToastMessage.textContent = `The correct answer was: ${correct_country}`;
                    const correctAnswerToast = bootstrap.Toast.getOrCreateInstance(correctAnswerToastEl);
                    correctAnswerToast.show();

                    const heroText = distance == 0 ? "Congratulations! üèÖ" : "Better luck next time...";

                    const endGameModalBody = document.querySelector("#endGameModal .col");

                    endGameModalBody.innerHTML = '';

                    const resulth1 = document.createElement("h1");
                    resulth1.innerText = heroText
                    endGameModalBody.appendChild(resulth1);

                    const resulth2 = document.createElement("h2");
                    resulth2.innerText = "Olymple"
                    endGameModalBody.appendChild(resulth2);

                    const resultp = document.createElement("p");
                    resultp.innerText = `Puzzle #${gameId}`
                    endGameModalBody.appendChild(resultp);

                    const resultDiv = document.createElement("div");
                    resultDiv.innerHTML = performances.join("<br>");
                    endGameModalBody.appendChild(resultDiv);

                    const shareButton = document.createElement("button");

                    shareButton.type = "button";
                    shareButton.className = "btn btn-primary mt-3 mb-3";
                    shareButton.textContent = "Share";
                    shareButton.id = "shareButton"
                    endGameModalBody.appendChild(shareButton);

                    const share_button_placeholder = document.getElementById("share_button_placeholder");
                    const shareBtnCol = document.createElement("div");
                    shareBtnCol.className = "col-12";

                    const shareBtn = document.createElement("button");
                    shareBtn.type = "button";
                    shareBtn.className = "form-control btn btn-primary text-center";
                    shareBtn.textContent = "Share";
                    shareBtn.id = "globalShareButton";

                    shareBtnCol.appendChild(shareBtn);
                    share_button_placeholder.appendChild(shareBtnCol);

                    endGameModal.show()

                    document.getElementById("shareButton").addEventListener('click', function () {
                        shareButtonCopyClipboard(this)
                    })
                    document.getElementById("globalShareButton").addEventListener('click', function () {
                        shareButtonCopyClipboard(this)
                    })
                };

                document.getElementById("searchCountries").value = "";

                datalist.innerHTML = "";

                countries.slice(0, 5).forEach(country => {
                    const option = document.createElement("option");
                    option.value = country;
                    datalist.appendChild(option);
                });
            };
        </script>
</body>

</html>